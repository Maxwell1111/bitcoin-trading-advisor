<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Portfolio Advisor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .price-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 10px;
            color: white;
            margin-bottom: 30px;
        }

        .price-display h2 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .price-display .price {
            font-size: 3em;
            font-weight: bold;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .control-group input,
        .control-group select {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 1em;
        }

        .control-group input:focus,
        .control-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .recommendation {
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .recommendation.buy {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .recommendation.sell {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
            color: white;
        }

        .recommendation.hold {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .recommendation h2 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .confidence {
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .detail-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .detail-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .detail-card p {
            color: #333;
            line-height: 1.6;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 600;
            color: #666;
        }

        .metric-value {
            font-weight: bold;
            color: #333;
        }

        .reasoning {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            margin-top: 20px;
        }

        .reasoning h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .error {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            color: #856404;
            margin-bottom: 20px;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            opacity: 0.8;
        }

        .footer a {
            color: white;
            text-decoration: underline;
        }

        .dashboard-banner {
            background: linear-gradient(135deg, #f39c12 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .dashboard-banner:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .dashboard-banner h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .dashboard-banner p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .dashboard-banner .features {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .dashboard-banner .feature {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü™ô Bitcoin Portfolio Advisor</h1>
            <p>AI-Powered Trading Recommendations with Sentiment & Technical Analysis</p>
        </div>

        <div class="dashboard-banner" onclick="window.location.href='/dashboard'">
            <h2>üìä NEW: Professional Trading Dashboard</h2>
            <p>Interactive charts with Moving Averages & Historical Analysis</p>
            <div class="features">
                <span class="feature">üìà 200-Day SMA</span>
                <span class="feature">üéØ 21-Week EMA</span>
                <span class="feature">‚ö° Golden/Death Cross</span>
                <span class="feature">üìö Educational Content</span>
            </div>
        </div>

        <div class="card">
            <div id="priceDisplay" class="price-display">
                <h2>Current Bitcoin Price</h2>
                <div class="price" id="currentPrice">Loading...</div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label for="days">Historical Data (days)</label>
                    <input type="number" id="days" value="100" min="30" max="365">
                </div>
                <div class="control-group">
                    <label for="newsDays">News Period (days)</label>
                    <input type="number" id="newsDays" value="7" min="1" max="30">
                </div>
                <div class="control-group">
                    <label for="maxArticles">Max News Articles</label>
                    <input type="number" id="maxArticles" value="50" min="10" max="100">
                </div>
                <div class="control-group">
                    <label for="useMock">News Source</label>
                    <select id="useMock">
                        <option value="true">Mock Data (Demo)</option>
                        <option value="false">Live News (Requires API Key)</option>
                    </select>
                </div>
            </div>

            <button class="btn" id="analyzeBtn" onclick="getRecommendation()">
                üìä Get Trading Recommendation
            </button>
        </div>

        <div id="errorMessage"></div>
        <div id="loadingMessage"></div>
        <div id="results"></div>

        <div class="footer">
            <p>‚ö†Ô∏è <strong>Disclaimer:</strong> This is for educational purposes only. Not financial advice.
            Always do your own research before investing.</p>
            <p><a href="/docs" target="_blank">API Documentation</a> |
            <a href="https://github.com/Maxwell1111/bitcoin-trading-advisor" target="_blank">GitHub</a></p>
        </div>
    </div>

    <script>
        // Get current Bitcoin price on page load
        async function getCurrentPrice() {
            try {
                const response = await fetch('/api/price');
                const data = await response.json();
                document.getElementById('currentPrice').textContent =
                    '$' + data.price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            } catch (error) {
                document.getElementById('currentPrice').textContent = 'Error loading price';
                console.error('Error fetching price:', error);
            }
        }

        async function getRecommendation() {
            const button = document.getElementById('analyzeBtn');
            const errorDiv = document.getElementById('errorMessage');
            const loadingDiv = document.getElementById('loadingMessage');
            const resultsDiv = document.getElementById('results');

            // Clear previous results
            errorDiv.innerHTML = '';
            resultsDiv.innerHTML = '';

            // Show loading
            loadingDiv.innerHTML = '<div class="card loading">Analyzing Bitcoin market data</div>';
            button.disabled = true;

            try {
                const requestData = {
                    days: parseInt(document.getElementById('days').value),
                    news_days: parseInt(document.getElementById('newsDays').value),
                    max_articles: parseInt(document.getElementById('maxArticles').value),
                    use_mock: document.getElementById('useMock').value === 'true'
                };

                const response = await fetch('/api/recommendation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                displayRecommendation(data);
            } catch (error) {
                errorDiv.innerHTML = `
                    <div class="error">
                        <strong>Error:</strong> ${error.message}.
                        Please try again or use Mock Data mode.
                    </div>
                `;
                console.error('Error:', error);
            } finally {
                loadingDiv.innerHTML = '';
                button.disabled = false;
            }
        }

        function displayRecommendation(data) {
            const resultsDiv = document.getElementById('results');

            const recommendationClass = data.recommendation.toLowerCase().replace('_', '-');
            const confidencePercent = (data.confidence * 100).toFixed(0);

            resultsDiv.innerHTML = `
                <div class="card">
                    <div class="recommendation ${recommendationClass}">
                        <h2>${data.recommendation.replace('_', ' ')}</h2>
                        <div class="confidence">Confidence: ${confidencePercent}%</div>
                        <div>Current Price: $${data.current_price.toLocaleString()}</div>
                    </div>

                    <div class="details">
                        <div class="detail-card">
                            <h3>üìà Technical Analysis</h3>
                            <div class="metric">
                                <span class="metric-label">RSI</span>
                                <span class="metric-value">${data.signals.technical.details.rsi.value}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Signal</span>
                                <span class="metric-value">${data.signals.technical.details.rsi.signal}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">MACD</span>
                                <span class="metric-value">${data.signals.technical.details.macd.signal}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Recommendation</span>
                                <span class="metric-value">${data.signals.technical.recommendation.toUpperCase()}</span>
                            </div>
                        </div>

                        <div class="detail-card">
                            <h3>üì∞ Sentiment Analysis</h3>
                            <div class="metric">
                                <span class="metric-label">Overall</span>
                                <span class="metric-value">${data.signals.sentiment.details.overall}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Score</span>
                                <span class="metric-value">${data.signals.sentiment.details.compound.toFixed(3)}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Articles</span>
                                <span class="metric-value">${data.signals.sentiment.details.article_count}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Recommendation</span>
                                <span class="metric-value">${data.signals.sentiment.recommendation.toUpperCase()}</span>
                            </div>
                        </div>

                        ${data.signals.technical.details.ma_trend ? `
                        <div class="detail-card" style="grid-column: span 2;">
                            <h3>üìä Moving Averages Analysis</h3>
                            <div class="metric">
                                <span class="metric-label">Overall Trend</span>
                                <span class="metric-value" style="color: ${data.signals.technical.details.ma_trend.overall_trend.includes('uptrend') ? 'green' : data.signals.technical.details.ma_trend.overall_trend.includes('downtrend') ? 'red' : 'orange'}; font-weight: bold;">
                                    ${data.signals.technical.details.ma_trend.overall_trend.replace('_', ' ').toUpperCase()}
                                </span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">MA Alignment</span>
                                <span class="metric-value">${data.signals.technical.details.ma_trend.bullish_signals} Bullish / ${data.signals.technical.details.ma_trend.bearish_signals} Bearish</span>
                            </div>

                            ${data.signals.technical.details.moving_averages ? `
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                                <strong style="display: block; margin-bottom: 10px; color: #667eea;">Key Moving Averages:</strong>
                                ${data.signals.technical.details.moving_averages.sma_200 ? `
                                <div class="metric">
                                    <span class="metric-label">200-Day SMA (Bull/Bear Line)</span>
                                    <span class="metric-value">
                                        $${data.signals.technical.details.moving_averages.sma_200.value.toLocaleString()}
                                        <span style="color: ${data.signals.technical.details.moving_averages.sma_200.price_vs_ma === 'above' ? 'green' : 'red'}; font-weight: bold;">
                                            ${data.signals.technical.details.moving_averages.sma_200.price_vs_ma === 'above' ? '‚Üë' : '‚Üì'}
                                            ${Math.abs(data.signals.technical.details.moving_averages.sma_200.distance_pct)}%
                                        </span>
                                    </span>
                                </div>
                                ` : ''}
                                ${data.signals.technical.details.moving_averages.ema_147 ? `
                                <div class="metric">
                                    <span class="metric-label">21-Week EMA (Bull Support)</span>
                                    <span class="metric-value">
                                        $${data.signals.technical.details.moving_averages.ema_147.value.toLocaleString()}
                                        <span style="color: ${data.signals.technical.details.moving_averages.ema_147.price_vs_ma === 'above' ? 'green' : 'red'}; font-weight: bold;">
                                            ${data.signals.technical.details.moving_averages.ema_147.price_vs_ma === 'above' ? '‚Üë' : '‚Üì'}
                                            ${Math.abs(data.signals.technical.details.moving_averages.ema_147.distance_pct)}%
                                        </span>
                                    </span>
                                </div>
                                ` : ''}
                                ${data.signals.technical.details.moving_averages.sma_50 ? `
                                <div class="metric">
                                    <span class="metric-label">50-Day SMA</span>
                                    <span class="metric-value">
                                        $${data.signals.technical.details.moving_averages.sma_50.value.toLocaleString()}
                                        <span style="color: ${data.signals.technical.details.moving_averages.sma_50.price_vs_ma === 'above' ? 'green' : 'red'};">
                                            ${data.signals.technical.details.moving_averages.sma_50.price_vs_ma === 'above' ? '‚Üë' : '‚Üì'}
                                            ${Math.abs(data.signals.technical.details.moving_averages.sma_50.distance_pct)}%
                                        </span>
                                    </span>
                                </div>
                                ` : ''}
                                ${data.signals.technical.details.moving_averages.ema_20 ? `
                                <div class="metric">
                                    <span class="metric-label">20-Day EMA</span>
                                    <span class="metric-value">
                                        $${data.signals.technical.details.moving_averages.ema_20.value.toLocaleString()}
                                        <span style="color: ${data.signals.technical.details.moving_averages.ema_20.price_vs_ma === 'above' ? 'green' : 'red'};">
                                            ${data.signals.technical.details.moving_averages.ema_20.price_vs_ma === 'above' ? '‚Üë' : '‚Üì'}
                                            ${Math.abs(data.signals.technical.details.moving_averages.ema_20.distance_pct)}%
                                        </span>
                                    </span>
                                </div>
                                ` : ''}
                            </div>
                            ` : ''}

                            ${data.signals.technical.details.ma_crossovers && (data.signals.technical.details.ma_crossovers.golden_cross || data.signals.technical.details.ma_crossovers.death_cross) ? `
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                                ${data.signals.technical.details.ma_crossovers.golden_cross ? `
                                <div class="metric">
                                    <span class="metric-label">üåü Golden Cross</span>
                                    <span class="metric-value" style="color: green; font-weight: bold;">DETECTED!</span>
                                </div>
                                <p style="font-size: 0.9em; color: #666; margin-top: 5px;">50 SMA crossed above 200 SMA - Strong bull signal</p>
                                ` : ''}
                                ${data.signals.technical.details.ma_crossovers.death_cross ? `
                                <div class="metric">
                                    <span class="metric-label">‚ò†Ô∏è Death Cross</span>
                                    <span class="metric-value" style="color: red; font-weight: bold;">DETECTED!</span>
                                </div>
                                <p style="font-size: 0.9em; color: #666; margin-top: 5px;">50 SMA crossed below 200 SMA - Strong bear signal</p>
                                ` : ''}
                            </div>
                            ` : ''}
                        </div>
                        ` : ''}

                        <div class="detail-card">
                            <h3>üéØ Price Targets</h3>
                            ${data.targets.target_1 ? `
                                <div class="metric">
                                    <span class="metric-label">Entry</span>
                                    <span class="metric-value">$${data.targets.entry.toLocaleString()}</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Target 1</span>
                                    <span class="metric-value">$${data.targets.target_1.toLocaleString()}</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Target 2</span>
                                    <span class="metric-value">$${data.targets.target_2.toLocaleString()}</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Stop Loss</span>
                                    <span class="metric-value">$${data.targets.stop_loss.toLocaleString()}</span>
                                </div>
                            ` : `
                                <div class="metric">
                                    <span class="metric-label">Current</span>
                                    <span class="metric-value">$${data.targets.entry.toLocaleString()}</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Support</span>
                                    <span class="metric-value">$${data.targets.support.toLocaleString()}</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Resistance</span>
                                    <span class="metric-value">$${data.targets.resistance.toLocaleString()}</span>
                                </div>
                            `}
                        </div>
                    </div>

                    <div class="reasoning">
                        <h3>üí° Analysis Reasoning</h3>
                        <p>${data.reasoning}</p>
                    </div>

                    ${data.signals.technical.details.moving_averages ? `
                    <div style="margin-top: 20px;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">üìê Key Moving Averages</h3>
                        <div class="details" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                            ${Object.entries(data.signals.technical.details.moving_averages)
                                .filter(([key, ma]) => [20, 50, 200].includes(ma.period))
                                .map(([key, ma]) => `
                                <div class="detail-card" style="padding: 15px;">
                                    <h4 style="margin: 0 0 10px 0; color: #667eea;">${ma.type} ${ma.period}</h4>
                                    <div class="metric" style="padding: 5px 0; border: none;">
                                        <span class="metric-label">Value</span>
                                        <span class="metric-value">$${ma.value.toLocaleString()}</span>
                                    </div>
                                    <div class="metric" style="padding: 5px 0; border: none;">
                                        <span class="metric-label">Price vs MA</span>
                                        <span class="metric-value" style="color: ${ma.price_vs_ma === 'above' ? 'green' : 'red'};">
                                            ${ma.price_vs_ma.toUpperCase()} (${ma.distance_pct > 0 ? '+' : ''}${ma.distance_pct}%)
                                        </span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // Load price on page load
        getCurrentPrice();

        // Refresh price every 60 seconds
        setInterval(getCurrentPrice, 60000);
    </script>
</body>
</html>
